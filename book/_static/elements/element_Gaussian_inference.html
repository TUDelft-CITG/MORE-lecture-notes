<!DOCTYPE html>
<html>

  <head>
    <meta name="2D Gaussian inference" content="a basic example for 2-D Gaussian inference">
    <title>2D Gaussian inference</title>
    <script src="https://unpkg.com/mathjs/lib/browser/math.js"></script>
    
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://unpkg.com/d3-simple-slider"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/pca-js@1.0.0/pca.min.js"></script>
    
    <style>
        #my_dataviz { position: relative; } 
        #click { position: absolute; } 
        #myCheckbox { position: absolute; top: 0; left: 0; }
        
        body{
          margin: 0; overflow: hidden;
          font-family: Helvetica, sans-serif;
        }
        .my_datavizdiv {
            position: absolute;
        }
        svg {
          position: absolute;
          top: 0;
          left: 0;
          background-color: None
        }    
        
    </style>
    
  </head>
  
  <!-- Create a div where the graph will take place -->
<div id="my_dataviz">
  <svg id="click" xmlns="http://www.w3.org/2000/svg">
      <defs>
          <g id="pointer" transform="scale(0.5)">
              <rect x="0" y="0" width="100" height="100" id="dragcircle" />
          </g>
          <marker
            id="arrow"
            markerUnits="strokeWidth"
            markerWidth="6"
            markerHeight="6"
            viewBox="0 0 12 12"
            refX="8.5"
            refY="6"
            orient="auto">
            <path d="M2,2 L10,6 L2,10 L6,6 L2,2" style="fill: #fac205;"></path>
          </marker>
      </defs>
  </svg>
  
<svg id="satellite" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 852 1120"><defs><style>.clsX-1{fill:url(#linear-gradientX-4);}.clsX-1,.clsX-2,.clsX-3,.clsX-4,.clsX-5,.clsX-6,.clsX-7,.clsX-8,.clsX-9,.clsX-10,.clsX-11,.clsX-12,.clsX-13,.clsX-14,.clsX-15,.clsX-16,.clsX-17,.clsX-18,.clsX-19,.clsX-20,.clsX-21,.clsX-22,.clsX-23,.clsX-24,.clsX-25,.clsX-26{fill-rule:evenodd;}.clsX-2{fill:url(#linear-gradientX-12);}.clsX-3{fill:url(#linear-gradientX-21);}.clsX-4{fill:url(#linear-gradientX-2);}.clsX-5{fill:url(#linear-gradientX);}.clsX-6{fill:url(#linear-gradientX-15);}.clsX-7{fill:url(#linear-gradientX-24);}.clsX-8{fill:url(#linear-gradientX-9);}.clsX-9{fill:url(#linear-gradientX-25);}.clsX-10{fill:url(#linear-gradientX-6);}.clsX-11{fill:url(#linear-gradientX-16);}.clsX-12{fill:url(#linear-gradientX-26);}.clsX-13{fill:url(#linear-gradientX-14);}.clsX-14{fill:url(#linear-gradientX-5);}.clsX-15{fill:url(#linear-gradientX-23);}.clsX-16{fill:url(#linear-gradientX-10);}.clsX-17{fill:url(#linear-gradientX-18);}.clsX-18{fill:url(#linear-gradientX-11);}.clsX-27{clip-path:url(#clippath);}.clsX-19{fill:url(#linear-gradientX-19);}.clsX-28{fill:none;}.clsX-20{fill:url(#linear-gradientX-20);}.clsX-21{fill:url(#linear-gradientX-22);}.clsX-22{fill:url(#linear-gradientX-13);}.clsX-23{fill:url(#linear-gradientX-7);}.clsX-24{fill:url(#linear-gradientX-8);}.clsX-25{fill:url(#linear-gradientX-3);}.clsX-26{fill:url(#linear-gradientX-17);}</style><clipPath id="clippath"><rect class="clsX-28" width="852" height="1120"/></clipPath><linearGradient id="linear-gradientX" x1="1430.93" y1="541.41" x2="1701.63" y2="94.3" gradientTransform="translate(-1285 584) scale(1 -1)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#387fa6"/><stop offset=".02" stop-color="#377ea5"/><stop offset=".05" stop-color="#377ea5"/><stop offset=".07" stop-color="#377ea5"/><stop offset=".09" stop-color="#377ea5"/><stop offset=".11" stop-color="#377ea5"/><stop offset=".14" stop-color="#377ea4"/><stop offset=".16" stop-color="#377da4"/><stop offset=".18" stop-color="#377da4"/><stop offset=".2" stop-color="#377da3"/><stop offset=".23" stop-color="#377ca3"/><stop offset=".25" stop-color="#367ca2"/><stop offset=".27" stop-color="#367ba2"/><stop offset=".3" stop-color="#367ba1"/><stop offset=".32" stop-color="#367aa0"/><stop offset=".34" stop-color="#367aa0"/><stop offset=".36" stop-color="#35799f"/><stop offset=".39" stop-color="#35799e"/><stop offset=".41" stop-color="#35789d"/><stop offset=".43" stop-color="#34779c"/><stop offset=".45" stop-color="#34779b"/><stop offset=".48" stop-color="#34769a"/><stop offset=".5" stop-color="#337599"/><stop offset=".52" stop-color="#337498"/><stop offset=".55" stop-color="#337397"/><stop offset=".57" stop-color="#327296"/><stop offset=".59" stop-color="#327195"/><stop offset=".61" stop-color="#317093"/><stop offset=".64" stop-color="#317092"/><stop offset=".66" stop-color="#316e91"/><stop offset=".68" stop-color="#306d90"/><stop offset=".7" stop-color="#306c8e"/><stop offset=".73" stop-color="#2f6b8d"/><stop offset=".75" stop-color="#2f6a8b"/><stop offset=".77" stop-color="#2e698a"/><stop offset=".8" stop-color="#2e6888"/><stop offset=".82" stop-color="#2d6687"/><stop offset=".84" stop-color="#2d6585"/><stop offset=".86" stop-color="#2c6483"/><stop offset=".89" stop-color="#2c6382"/><stop offset=".91" stop-color="#2b6180"/><stop offset=".93" stop-color="#2a607e"/><stop offset=".95" stop-color="#2a5e7c"/><stop offset=".98" stop-color="#295d7a"/><stop offset="1" stop-color="#295c79"/></linearGradient><linearGradient id="linear-gradientX-2" x1="1722.65" y1="145.33" x2="1482.17" y2="542.55" gradientTransform="translate(-1285 584) scale(1 -1)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#387fa6"/><stop offset=".01" stop-color="#3980a7"/><stop offset=".03" stop-color="#3a82a9"/><stop offset=".04" stop-color="#3a83ab"/><stop offset=".06" stop-color="#3b85ad"/><stop offset=".07" stop-color="#3c87af"/><stop offset=".08" stop-color="#3d88b0"/><stop offset=".1" stop-color="#3e8ab2"/><stop offset=".11" stop-color="#3f8bb4"/><stop offset=".12" stop-color="#408db6"/><stop offset=".14" stop-color="#418eb7"/><stop offset=".15" stop-color="#4290b9"/><stop offset=".17" stop-color="#4391bb"/><stop offset=".18" stop-color="#4492bc"/><stop offset=".19" stop-color="#4494be"/><stop offset=".21" stop-color="#4595bf"/><stop offset=".22" stop-color="#4697c1"/><stop offset=".24" stop-color="#4798c2"/><stop offset=".25" stop-color="#4899c4"/><stop offset=".26" stop-color="#499ac5"/><stop offset=".28" stop-color="#499cc7"/><stop offset=".29" stop-color="#4a9dc8"/><stop offset=".31" stop-color="#4b9eca"/><stop offset=".32" stop-color="#4c9fcb"/><stop offset=".33" stop-color="#4ca1cc"/><stop offset=".35" stop-color="#4da2ce"/><stop offset=".36" stop-color="#4ea3cf"/><stop offset=".38" stop-color="#4ea4d0"/><stop offset=".39" stop-color="#4fa5d2"/><stop offset=".4" stop-color="#50a6d3"/><stop offset=".42" stop-color="#50a7d4"/><stop offset=".43" stop-color="#51a8d5"/><stop offset=".44" stop-color="#52a9d6"/><stop offset=".46" stop-color="#52aad7"/><stop offset=".47" stop-color="#53abd8"/><stop offset=".49" stop-color="#53acda"/><stop offset=".5" stop-color="#54addb"/><stop offset=".51" stop-color="#54aedc"/><stop offset=".53" stop-color="#55afdd"/><stop offset=".54" stop-color="#55b0de"/><stop offset=".56" stop-color="#56b1df"/><stop offset=".57" stop-color="#56b1df"/><stop offset=".58" stop-color="#57b2e0"/><stop offset=".6" stop-color="#57b3e1"/><stop offset=".61" stop-color="#58b4e2"/><stop offset=".62" stop-color="#58b4e3"/><stop offset=".64" stop-color="#59b5e4"/><stop offset=".65" stop-color="#59b6e4"/><stop offset=".67" stop-color="#5ab6e5"/><stop offset=".68" stop-color="#5ab7e6"/><stop offset=".69" stop-color="#5ab8e7"/><stop offset=".71" stop-color="#5bb8e7"/><stop offset=".72" stop-color="#5bb9e8"/><stop offset=".74" stop-color="#5bb9e8"/><stop offset=".75" stop-color="#5cbae9"/><stop offset=".76" stop-color="#5cbaea"/><stop offset=".78" stop-color="#5cbbea"/><stop offset=".79" stop-color="#5cbbeb"/><stop offset=".81" stop-color="#5dbceb"/><stop offset=".82" stop-color="#5dbcec"/><stop offset=".83" stop-color="#5dbcec"/><stop offset=".85" stop-color="#5dbdec"/><stop offset=".86" stop-color="#5ebded"/><stop offset=".88" stop-color="#5ebded"/><stop offset=".89" stop-color="#5ebded"/><stop offset=".9" stop-color="#5ebeee"/><stop offset=".92" stop-color="#5ebeee"/><stop offset=".93" stop-color="#5ebeee"/><stop offset=".94" stop-color="#5ebeee"/><stop offset=".96" stop-color="#5ebeee"/><stop offset=".97" stop-color="#5ebeee"/><stop offset=".99" stop-color="#5ebeee"/><stop offset="1" stop-color="#5fbfef"/></linearGradient><linearGradient id="linear-gradientX-3" x1="1646.66" y1="99.33" x2="1406.18" y2="496.55" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-4" x1="1722.65" y1="145.33" x2="1482.17" y2="542.55" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-5" x1="1646.66" y1="99.33" x2="1406.18" y2="496.55" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-6" x1="1722.65" y1="145.33" x2="1482.17" y2="542.55" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-7" x1="1646.66" y1="99.33" x2="1406.18" y2="496.55" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-8" x1="1722.65" y1="145.34" x2="1482.17" y2="542.55" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-9" x1="1646.66" y1="99.33" x2="1406.18" y2="496.55" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-10" x1="1722.65" y1="145.33" x2="1482.17" y2="542.55" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-11" x1="1646.66" y1="99.33" x2="1406.18" y2="496.55" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-12" x1="2058.35" y1="-492.9" x2="1787.67" y2="-45.78" xlink:href="#linear-gradientX"/><linearGradient id="linear-gradientX-13" x1="1764.77" y1="-93.73" x2="2005.25" y2="-490.95" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-14" x1="1840.76" y1="-47.73" x2="2081.24" y2="-444.95" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-15" x1="1764.77" y1="-93.73" x2="2005.25" y2="-490.95" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-16" x1="1840.76" y1="-47.73" x2="2081.24" y2="-444.95" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-17" x1="1764.78" y1="-93.73" x2="2005.26" y2="-490.95" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-18" x1="1840.76" y1="-47.73" x2="2081.24" y2="-444.95" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-19" x1="1764.78" y1="-93.73" x2="2005.26" y2="-490.95" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-20" x1="1840.76" y1="-47.73" x2="2081.24" y2="-444.95" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-21" x1="1764.77" y1="-93.73" x2="2005.25" y2="-490.95" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-22" x1="1840.76" y1="-47.73" x2="2081.24" y2="-444.95" xlink:href="#linear-gradientX-2"/><linearGradient id="linear-gradientX-23" x1="1351.84" y1="-254.92" x2="1380.82" y2="-211.79" gradientTransform="translate(-1285 584) scale(1 -1)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#295c79"/><stop offset=".59" stop-color="#4795c1"/><stop offset="1" stop-color="#4795c1"/></linearGradient><linearGradient id="linear-gradientX-24" x1="1329" y1="-252.55" x2="1515.27" y2="-115.55" gradientTransform="translate(-1285 584) scale(1 -1)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#387fa6"/><stop offset=".23" stop-color="#387fa6"/><stop offset=".74" stop-color="#295c79"/><stop offset="1" stop-color="#295c79"/></linearGradient><linearGradient id="linear-gradientX-25" x1="1331.21" y1="-255.56" x2="1517.48" y2="-118.56" xlink:href="#linear-gradientX-24"/><linearGradient id="linear-gradientX-26" x1="1696.57" y1="185.39" x2="1817.24" y2="-125.85" xlink:href="#linear-gradientX"/></defs><g id="Layer_1-2"><g class="clsX-27"><g><path class="clsX-5" d="m207.08,5.58c16.89-10.22,38.86-4.82,49.08,12.06l233.67,385.97c10.22,16.88,4.82,38.86-12.06,49.08l-122.29,74.03c-16.88,10.22-38.86,4.82-49.08-12.06L72.73,128.69c-10.22-16.88-4.82-38.86,12.07-49.08L207.08,5.58Z"/><path class="clsX-4" d="m460.53,411.76c3.19,5.28,1.5,12.14-3.77,15.34l-38.22,23.14c-5.27,3.2-12.14,1.51-15.34-3.77l-28.95-47.82c-3.19-5.28-1.5-12.14,3.77-15.34l38.22-23.14c5.27-3.19,12.14-1.51,15.33,3.77l28.96,47.82Z"/><path class="clsX-25" d="m384.54,457.77c3.19,5.27,1.5,12.14-3.77,15.33l-38.22,23.14c-5.27,3.19-12.14,1.51-15.34-3.77l-28.95-47.82c-3.19-5.28-1.5-12.14,3.77-15.34l38.22-23.13c5.27-3.2,12.14-1.51,15.34,3.77l28.95,47.82Z"/><path class="clsX-1" d="m410.08,328.44c3.2,5.28,1.51,12.14-3.77,15.34l-38.21,23.14c-5.28,3.19-12.14,1.51-15.34-3.77l-28.95-47.82c-3.19-5.28-1.51-12.14,3.77-15.34l38.22-23.13c5.27-3.2,12.14-1.51,15.33,3.77l28.95,47.82Z"/><path class="clsX-14" d="m334.09,374.45c3.2,5.28,1.51,12.14-3.76,15.34l-38.22,23.14c-5.28,3.19-12.14,1.51-15.34-3.77l-28.95-47.82c-3.19-5.28-1.51-12.14,3.77-15.34l38.22-23.14c5.27-3.19,12.14-1.51,15.33,3.77l28.95,47.82Z"/><path class="clsX-10" d="m360.58,246.68c3.2,5.28,1.51,12.14-3.77,15.34l-38.21,23.14c-5.28,3.19-12.15,1.51-15.34-3.77l-28.95-47.82c-3.2-5.28-1.51-12.14,3.77-15.34l38.21-23.14c5.28-3.19,12.15-1.51,15.34,3.77l28.95,47.82Z"/><path class="clsX-23" d="m284.59,292.68c3.2,5.28,1.51,12.14-3.77,15.34l-38.21,23.14c-5.28,3.19-12.15,1.51-15.34-3.77l-28.95-47.82c-3.2-5.28-1.51-12.14,3.77-15.34l38.21-23.14c5.28-3.19,12.15-1.51,15.34,3.77l28.95,47.82Z"/><path class="clsX-24" d="m311.18,165.08c3.19,5.28,1.51,12.14-3.77,15.34l-38.21,23.13c-5.28,3.19-12.15,1.51-15.34-3.77l-28.95-47.82c-3.2-5.28-1.51-12.14,3.77-15.34l38.21-23.14c5.28-3.19,12.14-1.51,15.34,3.77l28.95,47.82Z"/><path class="clsX-8" d="m235.19,211.08c3.19,5.28,1.51,12.14-3.77,15.34l-38.21,23.13c-5.28,3.19-12.15,1.51-15.34-3.77l-28.95-47.82c-3.2-5.28-1.51-12.14,3.77-15.34l38.21-23.14c5.28-3.2,12.14-1.51,15.34,3.77l28.95,47.82Z"/><path class="clsX-16" d="m260.56,81.47c3.2,5.28,1.51,12.14-3.76,15.34l-38.22,23.14c-5.28,3.19-12.14,1.51-15.34-3.77l-28.95-47.82c-3.19-5.28-1.51-12.14,3.77-15.34l38.22-23.14c5.27-3.2,12.14-1.51,15.33,3.77l28.95,47.82Z"/><path class="clsX-18" d="m184.58,127.48c3.19,5.28,1.5,12.14-3.77,15.34l-38.22,23.14c-5.27,3.19-12.14,1.51-15.34-3.77l-28.95-47.82c-3.19-5.28-1.5-12.14,3.77-15.34l38.22-23.14c5.27-3.19,12.14-1.51,15.33,3.77l28.96,47.82Z"/><path class="clsX-2" d="m712.21,1113.91c-16.88,10.23-38.86,4.82-49.08-12.06l-233.67-385.97c-10.22-16.88-4.82-38.86,12.07-49.08l122.28-74.03c16.89-10.22,38.86-4.82,49.08,12.06l233.67,385.97c10.22,16.88,4.82,38.86-12.06,49.08l-122.29,74.03Z"/><path class="clsX-22" d="m456.9,704.64c-3.2-5.28-1.51-12.14,3.77-15.34l38.21-23.13c5.28-3.2,12.15-1.51,15.34,3.77l28.95,47.82c3.2,5.27,1.51,12.14-3.77,15.34l-38.21,23.13c-5.28,3.2-12.15,1.51-15.34-3.77l-28.95-47.82Z"/><path class="clsX-13" d="m532.89,658.63c-3.2-5.27-1.51-12.14,3.77-15.33l38.21-23.14c5.28-3.19,12.15-1.51,15.34,3.77l28.95,47.82c3.2,5.28,1.51,12.15-3.77,15.34l-38.21,23.14c-5.28,3.19-12.15,1.5-15.34-3.77l-28.95-47.83Z"/><path class="clsX-6" d="m507.34,787.96c-3.19-5.28-1.51-12.15,3.77-15.34l38.21-23.14c5.28-3.19,12.15-1.5,15.34,3.77l28.95,47.83c3.2,5.27,1.51,12.14-3.77,15.33l-38.21,23.14c-5.28,3.19-12.14,1.51-15.34-3.77l-28.95-47.82Z"/><path class="clsX-11" d="m583.33,741.95c-3.19-5.27-1.51-12.14,3.77-15.33l38.21-23.14c5.28-3.19,12.15-1.51,15.34,3.77l28.95,47.82c3.2,5.28,1.51,12.14-3.77,15.34l-38.21,23.13c-5.28,3.2-12.14,1.51-15.34-3.77l-28.95-47.82Z"/><path class="clsX-26" d="m556.84,869.73c-3.19-5.28-1.5-12.15,3.77-15.34l38.22-23.14c5.27-3.19,12.14-1.5,15.34,3.77l28.95,47.82c3.19,5.28,1.5,12.15-3.77,15.34l-38.22,23.14c-5.27,3.19-12.14,1.5-15.33-3.77l-28.96-47.82Z"/><path class="clsX-17" d="m632.83,823.72c-3.19-5.28-1.5-12.14,3.77-15.34l38.22-23.13c5.27-3.2,12.14-1.51,15.34,3.77l28.95,47.82c3.19,5.28,1.5,12.14-3.77,15.34l-38.22,23.13c-5.27,3.2-12.14,1.51-15.34-3.77l-28.95-47.82Z"/><path class="clsX-19" d="m606.25,951.33c-3.2-5.28-1.51-12.15,3.77-15.34l38.21-23.14c5.28-3.19,12.14-1.5,15.34,3.77l28.95,47.83c3.19,5.27,1.51,12.14-3.77,15.33l-38.22,23.14c-5.27,3.19-12.14,1.5-15.33-3.77l-28.95-47.82Z"/><path class="clsX-20" d="m682.23,905.32c-3.19-5.27-1.5-12.14,3.77-15.34l38.22-23.13c5.28-3.2,12.14-1.51,15.34,3.77l28.95,47.82c3.19,5.28,1.5,12.14-3.77,15.34l-38.22,23.13c-5.27,3.2-12.14,1.51-15.33-3.77l-28.96-47.82Z"/><path class="clsX-3" d="m656.86,1034.93c-3.19-5.28-1.51-12.14,3.77-15.34l38.21-23.13c5.28-3.2,12.15-1.51,15.34,3.77l28.95,47.82c3.2,5.27,1.51,12.14-3.77,15.34l-38.21,23.13c-5.28,3.2-12.14,1.51-15.34-3.77l-28.95-47.82Z"/><path class="clsX-21" d="m732.85,988.93c-3.2-5.28-1.51-12.15,3.77-15.34l38.21-23.14c5.28-3.19,12.15-1.5,15.34,3.77l28.95,47.82c3.2,5.28,1.51,12.15-3.77,15.34l-38.21,23.14c-5.28,3.19-12.14,1.5-15.34-3.77l-28.95-47.82Z"/><path class="clsX-15" d="m102.9,831.85c-8.01,11.91-24.15,15.08-36.06,7.07-11.91-8-15.08-24.15-7.08-36.06,8.01-11.91,24.15-15.07,36.06-7.07,11.92,8,15.08,24.15,7.08,36.06Z"/><path class="clsX-7" d="m2.4,728.09c37.61-56.77,114.12-72.29,170.88-34.68s72.28,114.12,34.66,170.88c-.05.09-.11.17-.16.25l-102.61-68.35L2.4,728.09Z"/><path class="clsX-9" d="m123.47,768.72c56.67,37.74,94.42,80.64,84.31,95.82-10.11,15.17-64.24-3.13-120.91-40.87-56.67-37.75-94.42-80.65-84.31-95.82,10.1-15.18,64.24,3.12,120.91,40.87Z"/><path class="clsX-12" d="m791.85,384.83c24.31,40.14,11.47,92.38-28.68,116.69l-473,286.36c-40.14,24.3-92.38,11.46-116.69-28.69l-21.52-35.55c-24.3-40.14-11.46-92.39,28.68-116.69l96.36-58.34,376.64-228.02c40.14-24.3,92.39-11.46,116.69,28.68l21.52,35.55Z"/></g></g></g></svg>
  
</div>

<!-- Create a div where the graph will take place -->

  <body>
    <script>
    
    // ===================================================
    // Set up basic viewport options
    // ===================================================
    const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0)
    const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0)
      
    var height 	= math.min([vw,vh])*0.95; // 450
    var width 	= math.min([vw,vh])*0.95;

    var svg = d3.select("#click") // This selects the div
    .attr("width", width) // This defines the canvas' width
    .attr("height", height) // This defines the canvas' height
    
    
    var xrange 	= [-3,3];
    var yrange 	= [-3,3];

    // Create some basic 2D random variables

    var mu 				= [0,0];
    var cov 			= [[1,0.85],[0.85,1]];
    
    
    var newmu 		= 0;
    var newsd 		= 1;
    
    var observation = 1.5;
    
    var prior_sd 	= 0.5;
    var obs_sd 		= 0.5;
    cov = construct_cov(prior_sd,obs_sd);

    
    var newpts
    var pdfpts = [];
    var pdfvals = [];
    
    dx 	= 6/1000;
    
    for (j = 0; j < 1001; j++) {
    
    	pdfpts.push(j*dx-3);
      pdfvals.push(math.exp(-math.pow(j*dx-3,2)/2));
    
    }
    
      const color_prior = "#fac205";
      const color_likelihood = "#0485d1";
      const color_observation = "#3f9b0b";
      const color_posterior = "#f43605"//"#02c14d";
      
      
      
      
      
      x_limits = xrange
      y_limits = yrange

      window_x 	= [width*0.1,width*0.8];
      window_y 	= [height*0.025,height*0.725];
      
      svg.append("polygon")
         .attr("points","0,0"+" "+window_x[0].toString()+",0"+" "+window_x[0].toString()+","+window_y[1].toString()+" "+window_x[1].toString()+","+window_y[1].toString()+" "+window_x[1].toString()+",0"+" "+width.toString()+",0"+" "+width.toString()+","+height.toString()+" "+"0,"+height.toString())
         .style("fill", "#ffffff") // ffffc2 #4794c1 047495 516572
         .style("stroke", "None")
         .style("strokeWidth", "0px");
      
      svg.append('line')
        .style("stroke", color_observation)
        .style("stroke-width", 3*width/600)
        .attr("x1", values_to_pixels(observation,"x"))
        .attr("y1", values_to_pixels(-3,"y"))
        .attr("x2", values_to_pixels(observation,"x"))
        .attr("y2", values_to_pixels(3,"y"))
        .attr("id","observation_line");
        

       
       
       
        
        

      svg.append('rect')
        .attr('x', width*0.125)
        .attr('y', height*0.035)
        .attr('width', width*0.05)
        .attr('height', height*0.025)
        .attr('stroke', 'None')
        .attr('fill', color_prior);
        
      svg.append("text")             
          .attr("transform",
                "translate("+(width*0.2).toString()+","+(height*0.055).toString()+")")
          .style("text-anchor", "left")
          .text("prior")
          .style("font-family", "arial")
          .style("font-size", (16*width/600).toString()+"px")

      svg.append('rect')
        .attr('x', width*0.125)
        .attr('y', height*0.085)
        .attr('width', width*0.05)
        .attr('height', height*0.025)
        .attr('stroke', 'None')
        .style('opacity', 0.75)
        .attr('fill', color_likelihood);
        
      svg.append("text")             
          .attr("transform",
                "translate("+(width*0.2).toString()+","+(height*0.105).toString()+")")
          .style("text-anchor", "left")
          .text("observation / likelihood")
          .style("font-family", "arial")
          .style("font-size", (16*width/600).toString()+"px")
        
      svg.append('rect')
        .attr('x', width*0.125)
        .attr('y', height*0.135)
        .attr('width', width*0.05)
        .attr('height', height*0.025)
        .attr('stroke', 'None')
        .style('opacity', 0.75)
        .attr('fill', color_posterior);

       svg.append("text")             
          .attr("transform",
                "translate("+(width*0.2).toString()+","+(height*0.155).toString()+")")
          .style("text-anchor", "left")
          .text("posterior")
          .style("font-family", "arial")
          .style("font-size", (16*width/600).toString()+"px")


      
      // Get scaling functions for the x scale and the y_scale
      const xScale = d3.scaleLinear()
        .domain([x_limits[0],x_limits[1]])
        .range(window_x)
      const xScale_inverse = d3.scaleLinear()
        .domain(window_x)
        .range([x_limits[0],x_limits[1]])
      const yScale = d3.scaleLinear()
        .domain([y_limits[0],y_limits[1]])
        .range([window_y[1],window_y[0]])

      // Draw the x axis
      svg
        .append("g")
        .attr("transform", "translate(0,"+window_y[1].toString()+")")
        .call(d3.axisBottom(xScale))
        .style("font-size", (16*width/600).toString()+"px")
      svg.append("text")             
          .attr("transform",
                "translate("+(math.mean(window_x)).toString()+","+(height*0.81).toString()+")")
          .style("text-anchor", "middle")
          .text("observation prediction y")
          .style("font-family", "arial")
          .style("font-size", (16*width/600).toString()+"px")
          
      
      // Draw the y axis
      svg
        .append("g")
        .attr("transform", "translate("+(window_x[0]).toString()+",0)")
        .attr("id","mainxaxis")
        .call(d3.axisLeft(yScale))
        .style("font-size", (16*width/600).toString()+"px");
        //.call(d3.axisLeft(yScale).tickFormat(""));
      svg.append("text")             
          .attr("transform",
                "translate("+(width*0.02).toString()+","+(math.mean(window_y)).toString()+") rotate(270)")
          .style("text-anchor", "middle")
          .text("state x")
          .style("font-family", "arial")
          .style("font-size", (16*width/600).toString()+"px")








     var sat_width = width*0.06;
     var sat_height = height*0.075;
          
     /*
     svg.append("image")
          .attr("xlink:href","https://drive.google.com/uc?export=download&id=1xvYIdP62FtPqOPL5nSNYpZzQcgNrKWSt")
          .attr("width", sat_width)
          .attr("height", sat_height)
          .attr("x",width*0.935)
          .attr("y",values_to_pixels(mu[1],"y")-sat_height/2)  
          .attr("id","satellite_prior")
      */
          
      var satellite = d3.select("#satellite") // This selects the div
          .attr("width", sat_width)
          .attr("height", sat_height)
          .attr("transform", "translate("+(width*0.935).toString()+","+(values_to_pixels(mu[1],"y")-sat_height/2).toString()+")"	)
          .style("opacity",1)
          .attr("id","satellite_prior")

     svg.append("image")
          .attr("xlink:href","https://drive.google.com/uc?export=download&id=1xnxMYueKHLsiaI-_G17rkkmnzlxG_IEA")
          .attr("width", sat_width)
          .attr("height", sat_height)
          .attr("x",width*0.935)
          .attr("y",values_to_pixels(0.75,"y")-sat_height/2)  
          .attr("id","satellite_posterior")

			svg.append("circle")
       	 .style("stroke", "#A2DA78")
       	 .style("fill", "None")
       	 .style("stroke-width",width*0.005)
       	 .attr("r",width*0.025)
       	 .attr("cx", width*0.965)
       	 .attr("cy", values_to_pixels(observation,"y"))
         .attr("id","obs_circ");

			svg.append("circle")
       	 .style("stroke", "None")
       	 .style("fill", color_observation)
       	 .attr("r",width*0.0125)
       	 .attr("cx", width*0.965)
       	 .attr("cy", values_to_pixels(observation,"y"))
         .attr("id","obs_center");

      // Create a line from prior to posterior
      svg.append("line")
        .attr("x1",width*0.965)  
        .attr("y1",values_to_pixels(0.75,"y"))  
        .attr("x2",width*0.965)  
        .attr("y2",values_to_pixels(mu[1],"y"))  
        .attr("stroke",color_prior)  
        .attr("stroke-width",width*0.01)  
        .attr("marker-end","url(#arrow)")
        .attr("id","update_arrow");






			// Draw the new contours
      update()
      
      
      
      
      
      
      
      
      svg.append("text")             
          .attr("transform",
                "translate("+(width*0.25).toString()+","+(height*0.875).toString()+")")
          .style("text-anchor", "middle")
          .text("prior standard deviation")
          .style("font-family", "arial")
          .style("font-size", (16*width/600).toString()+"px")
      
      var slider_prior = d3
        .sliderBottom()
        .min(0)
        .max(2)
        .width(width*0.3)
        .height(height*0.1)
        .ticks(5)
        .tickPadding(0)
        .displayValue(false)
        .default(prior_sd)
        
        .handle(
          d3
            .symbol()
            .type(d3.symbolCircle)
            .size(width/5)
        )
        .tickFormat(d3.format(','))
        .fill(color_prior)
        .on('onchange', val => {
          d3.select('p#value-fill').text(d3.format('%')(val));
          prior_sd = val
          update()
        });

      var slider_prior_obj = d3
        .select('svg')
        .append('svg')
        .attr('width', width)
        .attr('height', height)
        .append('g')
        .attr('transform', 'translate('+width*0.1+','+height*0.9+')');
        
      slider_prior_obj.call(slider_prior);
      
      
      svg.append("text")             
          .attr("transform",
                "translate("+(width*0.75).toString()+","+(height*0.875).toString()+")")
          .style("text-anchor", "middle")
          .text("observation error standard deviation")
          .style("font-family", "arial")
          .style("font-size", (16*width/600).toString()+"px")
      
     var slider_obs = d3
        .sliderBottom()
        .min(0)
        .max(2)
        .width(width*0.3)
        .height(height*0.1)
        .ticks(5)
        .tickPadding(0)
        .displayValue(false)
        .default(obs_sd)
        .handle(
          d3
            .symbol()
            .type(d3.symbolCircle)
            .size(width/5)
        )
        .tickFormat(d3.format(','))
        .fill(color_likelihood)
        .on('onchange', val => {
          d3.select('p#value-fill').text(d3.format('%')(val));
          obs_sd = val
          update()
        });

      var slider_obs_obj = d3
        .select('svg')
        .append('svg')
        .attr('width', width)
        .attr('height', height)
        .append('g')
        .attr('transform', 'translate('+width*0.6+','+height*0.9+')');
        
      slider_obs_obj.call(slider_obs);
      

      
      
      
      
      
      
      
      
      svg
        .selectAll('.axis text')
        .attr('font-size', (16*width/600).toString()+"px") 
      

      
      
      
      
      
      
      
      
      // ======================================================
      // Define functions
      // ======================================================
      

    
    // helper function to output formatted results.
    function print(value) {
      var precision = 14;
      document.write(math.format(value, precision) + '<br>');
    }
    
    
     function pixels_to_values(coords,axis) {
    	axis = (typeof axis === 'undefined') ? 'xy' : axis;
    	if (axis == 'x') {
      	res = (coords-window_x[0])/(window_x[1]-window_x[0]) * (xrange[1]-xrange[0]) + xrange[0]
      } else if (axis == 'y') {
      	res = (1.-(coords-window_y[0])/(window_y[1]-window_y[0])) * (yrange[1]-yrange[0]) + yrange[0]
      } else {
      	res = [(coords[0]-window_x[0])/(window_x[1]-window_x[0]) * (xrange[1]-xrange[0]) + xrange[0],(1.-(coords[1]-window_y[0])/(window_y[1]-window_y[0])) * (yrange[1]-yrange[0]) + yrange[0]]
      }
     	return res;
    }

    function values_to_pixels(values,axis) {
    	axis = (typeof axis === 'undefined') ? 'xy' : axis;
    	if (axis == 'x') {
      	res = (values-xrange[0])/(xrange[1]-xrange[0])*(window_x[1]-window_x[0])+window_x[0];
      } else if (axis == 'y') {
      	res = (1-(values-yrange[0])/(yrange[1]-yrange[0]))*(window_y[1]-window_y[0])+window_y[0];
      } else {
      	res = [(values[0]-xrange[0])/(xrange[1]-xrange[0])*(window_x[1]-window_x[0])+window_x[0],(1-(values[1]-yrange[0])/(yrange[1]-yrange[0]))*(window_y[1]-window_y[0])+window_y[0]];
      }
     	return res;
    }
    

    function construct_cov() {
    
    	var cov = [[math.pow(prior_sd,2)+math.pow(obs_sd,2),math.pow(prior_sd,2)],[math.pow(prior_sd,2),math.pow(prior_sd,2)]];
      
      return cov;
    
    }
    

    
    function draw_contours(mu,cov) {
    
    	svg.selectAll(".contour_lines").remove();
      
      // Do a principal component analysis of the covariance matrix
      vectors = PCA.computeSVD(cov);
      
      // Get quantiles
      sds = [2.29742059, 1.75524714, 1.43500483, 1.17741105, 0.94003483,
       0.69449473, 0.38498817];
    
      colors = ['#4146ac', '#3aa3fc', '#25eca7', '#a4fc3c', '#f4c73a', '#f36315', '#b21a01'];
       

       
      for (j = 0; j < 7; j++) {
      
      	sd = sds[j]*math.sqrt(vectors[0]["eigenvalue"]);
      
      
      
        svg
          .append("ellipse")       // attach an ellipse
            .attr("cx", 0)
            .attr("cy", 0)
            .attr("rx", 0.7*width/6*sd)
            .attr("ry", 0.7*height/6*math.sqrt(vectors[1]["eigenvalue"])/math.sqrt(vectors[0]["eigenvalue"])*sd)
            .attr("transform",
                  "translate("+(values_to_pixels(mu[0],"x")).toString()+","+(values_to_pixels(mu[1],"y")).toString()+") rotate("+(-math.atan2(vectors[0]["vector"][1],vectors[0]["vector"][0])/math.pi*180).toString()+")")
            .attr("fill","None")
        .attr("stroke", colors[j])
        .attr("stroke-linejoin", "round")
            .attr('stroke-width',1*width/300)
            .attr("class","contour_lines").lower();
        
      }
      


        
    }
    
    function draw_x_marginal(mean,sd,color="#fac205",id="xmarg", alpha = 1.) {
    
    	xstart = width*0.81;
      xdiff  = width*0.125;
      
      pts 	= (xstart).toString()+","+(values_to_pixels(-3,axis="y")).toString()+" "
    
      dx 		= 6/1000
      
      maxval = 1/math.sqrt(2*math.pi*math.pow(sd,2))
      
      for (j = 0; j < 1001; j++) {
      
      	pdfx 		= -3+j*dx;
      	pdfval 	= math.exp(-math.pow(pdfx-mean,2)/2/math.pow(sd,2));
        
      	pts 		+= (pdfval*xdiff+xstart).toString()+","+(values_to_pixels(pdfx,axis="y")).toString() + " "
      
      }
      
      pts 	+= (xstart).toString()+","+(values_to_pixels(3,axis="y")).toString()+" "
      
      svg.selectAll("."+id).remove();

      svg.append("polygon")
         .attr("points", pts)
         .style("fill", color) // ffffc2 #4794c1 047495 516572
         .style("stroke", "None")
         .style("opacity", alpha)
         .attr("class",id);
      
    }
    
    function Kalman_update(mu,cov) {
    
    	// Get the Kalman Gain
      newmu 	= mu[1] - cov[1][0]/cov[0][0]*(mu[0] - observation);
      newcov	= cov[1][1] - cov[1][0]/cov[0][0]*cov[0][1];
      newsd	 	= math.sqrt(newcov);

      return [newmu, newsd]
    
    }
    
    function update() {
    
    	// Update covariance
    	var cov = construct_cov(prior_sd,obs_sd);
      
      res = Kalman_update(mu,cov);
      newmu 	= res[0];
      newsd 	= res[1];
      
      draw_contours(mu,cov)
      
      draw_x_marginal(mu[1],math.sqrt(cov[1][1]),color=color_prior) 
      draw_x_marginal(observation,obs_sd,color=color_likelihood,id="obserror",alpha=0.75)
      draw_x_marginal(newmu,newsd,color=color_posterior,id="post",alpha=0.75)
      
     	d3.select("#satellite_prior")
          .attr("y",values_to_pixels(mu[1],"y")-sat_height/2)
          .raise()

			d3.select("#obs_circ")
       	 .attr("cy", values_to_pixels(observation,"y"))
         .raise()

			d3.select("#obs_center")
       	 .attr("cy", values_to_pixels(observation,"y"))
         .raise()
      
     	d3.select("#satellite_posterior")
         .attr("y",values_to_pixels(newmu,"y")-sat_height/2)  
         .raise()
         
      d3.select("#update_arrow")
        .attr("y1",values_to_pixels(mu[1],"y"))  
        .attr("y2",values_to_pixels(mu[1],"y")+values_to_pixels(newmu,"y")-values_to_pixels(mu[1],"y"))
        .raise();
      
    }
    
      svg.append('circle')
        .attr("cx", values_to_pixels(observation,"x"))
        .attr("cy", values_to_pixels(-3,"y"))
        .attr("r", 17.5*height/750)
        .attr("stroke-width", 2*height/450)
        .attr("fill", "#ffffff")
        .attr("opacity",0.5)
        .attr("stroke",color_observation)
        .attr("id","observation_circle");
        
      svg.append('circle')
        .attr("cx", values_to_pixels(observation,"x"))
        .attr("cy", values_to_pixels(-3,"y"))
        .attr("r", 9*height/750)
        .attr("fill", color_observation)
        .attr("id","observation_circle_center");
        
      svg.append("text")             
          .attr("transform",
                "translate("+(values_to_pixels(observation,"x")+width*0.015).toString()+","+(height*0.695).toString()+")")
          .style("text-anchor", "left")
          .text("y*")
          .style("font-family", "arial")
          .style("fill",color_observation)
          .style("font-size", (16*width/600).toString()+"px")
          .attr("id","observation_label");
    
    // Resize the drag circle
    d3.select("#dragcircle")
    	.attr("height",height*1.55)
      .attr("width",width*0.1)
    
    
    
    svg.append("use")
      .attr("href", "#pointer")
      .attr("x", values_to_pixels(observation,"x"))
      .attr("y", height*0.025)
      .attr("r", 17.5*height/750)
      .attr("stroke-width", 5*height/450)
      .attr("fill", "#ffffff")
      .attr("opacity",0.)
      .attr("stroke",color_observation);

    
    


		var deltaX, deltaY

    var dragHandler = d3.drag()
          .on("start", function () {
          
              var current = d3.select(this);

              deltaX = current.attr("x") - d3.event.x;
              deltaY = current.attr("y") - d3.event.y;
              
              } 
          )
          .on("drag", function () {
          
          		var movex = d3.event.x + deltaX;
              var movey = d3.event.y + deltaY;
              var current = d3.select(this);
              
              // Limit movex, if necessary
              if (movex < window_x[0]) {
              	movex = window_x[0];
              } else if (movex > window_x[1]) {
              	movex = window_x[1];
              }
              
              // Limit movey, if necessary
              if (movey < window_y[0]) {
              	movey = window_y[0];
              } else if (movey > window_y[1]) {
              	movey = window_y[1];
              }
              
              current
                  .attr("x", movex);
              
              d3.select("#observation_line")
                .attr("x1", movex)
                .attr("x2", movex);
              d3.select("#observation_circle")
                .attr("cx", movex)
              d3.select("#observation_circle_center")
                .attr("cx", movex)
                
            	d3.select("#observation_label")          
              	.attr("transform",
                    	"translate("+(movex+width*0.015).toString()+","+(height*0.695).toString()+")");
              
              prop 	= pixels_to_values(movex,"x");

              observation = prop;

              update()
              
              }
              
          )
    
    
    
    
    dragHandler(svg.selectAll("use"));


    </script>
  </body>

</html>
